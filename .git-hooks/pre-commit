#!/bin/bash
# Git pre-commit hook
# Automatically synchronizes environment configuration before committing

echo "üîç Running pre-commit checks..."
echo ""

# Run sync-env.sh to ensure configuration is synchronized
if [ -f "./scripts/sync-env.sh" ]; then
    echo "üìã Synchronizing environment configuration..."
    ./scripts/sync-env.sh
    
    # Check if sync made any changes
    if git diff --quiet local.docker.yml traefik/traefik.yml .env; then
        echo "‚úÖ Configuration is synchronized"
    else
        echo ""
        echo "‚ö†Ô∏è  Configuration files were synchronized and updated:"
        git diff --name-only local.docker.yml traefik/traefik.yml .env | sed 's/^/  - /'
        echo ""
        echo "üìù These changes have been applied but not staged."
        echo "   Review the changes and stage them if needed:"
        echo "   git add local.docker.yml traefik/traefik.yml .env"
        echo ""
        echo "‚ùå Commit aborted. Please review and stage the synchronized files."
        exit 1
    fi
else
    echo "‚ö†Ô∏è  sync-env.sh not found, skipping synchronization"
fi

echo ""
echo "‚úÖ Pre-commit checks passed!"
exit 0
